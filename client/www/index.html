<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <title>Login</title>
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link href="common.css" rel="stylesheet" />
        <script type="text/javascript" src="common.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="third_party/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="third_party/jquery.rwdImageMaps.js"></script>
        <script type="text/javascript" src="third_party/soundjs-0.6.0.min.js"></script>

        <link rel="prefetch" href="mainmenu.html" />
    </head>
    <body>
      <img src="assets/main.webp" class="bg" usemap="#clickmap"></img>
      <map name="clickmap">
          <area shape="rect" id="pp" coords="1286,386,1500,690">
          <area shape="rect" coords="0,644,250,760" onclick="navigator.app.exitApp()">
      </map>
      <script>
        createjs.Sound.registerSound("assets/audio/start.mp3", 'start');
        createjs.Sound.on("fileload", function() {
            createjs.Sound.play('start', { loop: -1 });
        });

        $(document).ready(function(e) {
            $('img[usemap]').rwdImageMaps();
        });

        function login() {
            chrome.identity.getAuthToken({ 'interactive': true }, function (token, account) {
                if (chrome.runtime.lastError) {
                //FIXME:
                    navigator.app.exitApp();
                    return;
                }
                _network.ajax(host + 'v1/authorize/' + token + '/' + encodeURIComponent(account), undefined, function(data) {
                    console.log("account verified");
                    console.log(data);
                    localStorage.setItem('token', data);
                    $("#pp").attr("href", "mainmenu.html");
                });
                console.log(token);
                console.log(account);
            });
        }

        document.addEventListener('deviceready', function() {
            setTimeout(function() {
                navigator.splashscreen.hide();
                login();
            }, 2000);
        }, false);
      </script>
    </body>
</html>
