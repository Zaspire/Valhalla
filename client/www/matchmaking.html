 <!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <meta name="msapplication-tap-highlight" content="no" />
        <script type="text/javascript" src="third_party/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="common.js"></script>
        <title>MatchMaking UI</title>
        <style type="text/css" media="screen">
        img.bg {
            min-height: 100%;
            width: 100%;
            height: auto;

            position: fixed;
            top: 0;
            left: 0;
        }
        img.rotate {
            -webkit-animation: Spin 15s linear infinite;
        }
        @-webkit-keyframes Spin {
            0% { -webkit-transform: translate(-50%,-50%) rotate(0deg); }
            100% { -webkit-transform: translate(-50%,-50%) rotate(360deg); }
        }

        #hourglass {
            position: fixed;
            top: 50%;
            left: 50%;
            width: auto;
            height: 100%;
        }
        </style>
        <script type="text/javascript" src="cordova.js"></script>
    </head>
    <body>
      <img src="assets/glass_bg.png" class="bg"></img>
      <img src="assets/hourglass.png" id="hourglass" class="rotate"></img>

      <h1 id="header">waiting opponent...</h1>
      <script type="text/javascript">
        var params = {};
        params.token = localStorage.getItem('token');

        function request() {
            $.ajax({ url: host + 'v1/matchmaking/' + params.token }).done(function(data) {
                if (data == '{}') {
                    setTimeout(request, 1000);
                    return;
                }
                data = JSON.parse(data);
                $("#header").html('done');

                localStorage.setItem('gameid', data.gameid);
                window.location = 'game.html';
            }).fail(function() {
                //FIXME:
                $("#header").html('fail');
            });
        }
        request();
        document.addEventListener("deviceready", function keepAwake() {
            analytics.startTrackerWithId(GA_ACCOUNT);
            analytics.trackView('matchmaking');
        }, false);
      </script>
    </body>
</html>
